<{include file="default/Public/header" /}>
<script>
    var deleteAllActivity_URL = "<{:U('MovieRecognitionActivity/deleteAllActivity')}>";
    $(function () {
        //
        $(document).on("click", '#choose_all', function () {
            if (this.checked) {
                $(":checkbox[name='check']").prop('checked', true);
            } else {
                $(":checkbox[name='check']").prop('checked', false);
            }
        });

        //筛选
        $(document).on("change", '#filter_forum', function () {
            var fid = $(this).val();
            window.location.href = "<{:U('MovieRecognitionActivity/filterActivity')}>&fid=" + fid;
        });


        $(document).on('click', '#all_delete', function () {
            var repair = confirm("确定要批量删除吗？");
            if (repair == true) {
                var array = {};
                var i = 0;
                $(":checkbox[name='check']").each(function () {
                    if (this.checked) {
                        array["test[" + i + "]"] = $(this).attr("lid");
                        $("tr").remove('#' + $(this).attr("lid"));
                        i++;
                    }

                });
                $.ajax({
                    type: "POST",
                    url: deleteAllActivity_URL,
                    data: array,
                    dataType: "json",
                    success: function (data) {
                    }, async: true

                });
                window.location.reload();
            }

        });
    });
</script>
<div class="page-container row-fluid">

    <{include file="default/Index/left" /}>

</div>

<div class="page-content">

    <div class="container-fluid">

        <div class="row-fluid">

            <div class="span12">

                <h3 class="page-title">


                    认领包场活动管理>>活动列表
                    <small>活动列表</small>


                </h3>

            </div>

        </div>

        <div class="row-fluid">

            <div class="span12">

                <div class="portlet box light-grey">

                    <div class="portlet-title">

                        <div class="caption"><i class="icon-globe"></i>活动列表</div>

                        <div class="tools">

                            <a href="javascript:;" class="collapse"></a>

                            <a href="javascript:;" class="reload"></a>

                            <a href="javascript:;" class="remove"></a>

                        </div>

                    </div>
                    <a href="<{:U('Home/MovieRecognitionActivity/addActivity')}>">【+添加】</a>
                    <div class="portlet-body">
                        <span>筛选(工作室):</span>
                        <select id="filter_forum">
                            <{foreach name="forums" item="forum"}>
                            <option value='<{$forum.id}>'
                            <{if condition="$forum.id eq $fid"}>selected="selected"<{/if}>><{$forum.name}></option>
                            <{/foreach}>
                        </select>
                        <table class="table table-striped table-bordered table-hover" id="sample_1">

                            <thead>

                            <tr>

                                <th style="width:45px;">
                                    <input type="checkbox" id="choose_all"/>全选
                                </th>

                                <th>电影标题</th>

                                <th>所属工作室</th>

                                <th>所属影院</th>

                                <th>活动开始时间</th>

                                <th>活动报名截止时间</th>

                                <th>操作</th>
                            </tr>

                            </thead>
                            <label style="width: 86px">
                                <input style="margin-top: 10px" id="all_delete" type="button" value="批量删除"/>
                            </label>
                            <{foreach name="activityList" item="activity"}>

                            <tbody>

                            <tr class="odd gradeX">

                                <td>
                                    <input type="checkbox" class="checkboxes" name="check" lid="<{$activity.id}>">
                                </td>

                                <td>

                                    <a href="<{:U('Home/MovieRecognitionActivity/editActivity',array('id'=>$activity['id']))}>">

                                        <{$activity.mid|getMovieNameById}>

                                    </a>

                                </td>

                                <td class="hidden-480"><{$activity.fid|getForumNameById}></td>

                                <td class="hidden-480"><{$activity.cinema|getCinemaNameById}></td>


                                <td class="hidden-480"><{$activity['holdstart']|date='Y-m-d',###}></td>

                                <td class="hidden-480"><{$activity['encrollendtime']|date='Y-m-d',###}></td>

                                <td class="hidden-480">

                                    <a href="<{:U('Home/MovieRecognitionActivity/editActivity',array('id'=>$activity['id']))}>">编辑</a>

                                    <a href="<{:U('Home/MovieRecognitionActivity/delActivity',array('id'=>$activity['id']))}>">删除</a>　

                                </td>

                            </tr>

                            </tbody>

                            <{/foreach}>

                        </table>

                        <div style="margin-left:45%;">

                            <{$page}>

                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>

</div>

<script>

    $('.movie-recognition-activity').parent().show();
    $('.movie-recognition-activity a').css('color', '#ffffff');
    $('.movie-recognition-activity a').css('background', '#575757');

</script>

<{include file="default/Public/footer" /}>