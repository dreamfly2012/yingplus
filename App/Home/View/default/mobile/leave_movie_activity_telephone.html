<{include file="default/mobile/header"/}>
<link rel="stylesheet" type="text/css" href="/Public/mobile/css/vote.css"/>
<script src="/Public/default/js/jquery.ajaxfileupload.js"></script>
<script type="text/javascript" src="/Public/mobile/js/chat.js"></script>
<style>
.captchabtn {
    width: 25%;
    height: 30px;
    margin: -32px 10px 0px 9px;
    background: #fcb01f;
    border-radius: 4px;
    font: 16px/32px "microsoft yahei";
    color: #fff;
    display: block;
    text-align: center;
    position: absolute;
    right: 10px;
}
</style>
<div class="wrap" id="wrap">
    <{include file="default/mobile/nav" title="修改手机号"/}>

    <div>
        <span class="hei40"></span>
        <div class="">
            <p class="votetitle">手机号：</p>
            <div class="add_comright">
                <input type="text" id="telephone" class="text92per" placeholder="请输入手机号">
            </div>
            <div class="clear"></div>
        </div>
        <div class="addactiveitem">
            <p class="votetitle">验证码：</p>
            <input type="text" name="captcha" class="text92per" id="captcha" placeholder="验证码">
            <span id="sendcaptcha" data-type='register' class="captchabtn">获取验证码</span>
            <div class="clear"></div>
        </div>

        <a href="javascript:;" title="确认提交" class="votesubmit change_telephone_submit">确认修改</a>
    </div>



    <script type="text/javascript">
        

        $(document).ready(function() {
            //发送验验证码
            $("#sendcaptcha").click(function(){
                var telephone = $("#telephone").val();
                if(!check_phone(telephone)){
                    swal('手机号码格式不正确');
                    return false;
                }else{
                    $(this).countdown({
                        time : 60,
                        text : "秒",
                        stop : 0,
                        method : "text"
                    });
                    $.ajax({
                        url : send_captcha_url,
                        type: "POST",
                        cache:false,
                        data: {'telephone':telephone},
                        dataType: "json",
                        success: function(result){
                            if(result.data.code!=0){
                                swal(result.data.message);
                            }
                         },
                        async : true
                    });
                }
                
            });

            //修改手机号
            $(document).on('click','.change_telephone_submit',function(){
                var captcha = $('#captcha').val();
                var telephone = $('#telephone').val();

                if(telephone==''){
                    swal('手机号不能为空!');
                    return false;
                }

                //验证手机号格式

                if(!check_phone(telephone)){
                    swal('手机号格式不正确');
                    return;
                }

                if(captcha==''){
                    swal('验证码不能为空');
                    return false;
                }
                var backurl = "<{$backurl}>";
                $.post(check_captcha_url,{'telephone':telephone,'captcha':captcha},function(result){
                    if(result.data.code==0){
                        window.location.href = backurl + '?telephone='+ telephone;
                    }else{
                        swal(result.data.message);
                    }
                });
            });
        });
    </script>
</div>
</body>
</html>